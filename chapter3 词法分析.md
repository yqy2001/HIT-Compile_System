重难点：词法的正规文法表示、正规表达式表示、状态转移图表示（三种），以及它们之间的转换。词法分析器的输入输出。

## 3.1 词法分析器的功能

输入源程序，输出单词符号序列。

* 根据词法规则**识别**及组合单词，进行词法检查，输出和**处理词法错误**；
* 对数字常数完成数字字符串到二进制数值的转换；
* 删去空格字符和注释。

#### 3.1.1/3.1.2 单词的分类表示/词法分析器的输出

单词的种类：一般有关键字、标识符、常数、运算符、界符。

单词的内部形式：按单词种类分类，标识符和常数分别采用**类别编码**，而关键字、运算符和分界符采用**一符一码**。
种别码是语法分析器的输入符号。

<img src="https://i.loli.net/2021/03/17/g5HJfT72PX39sxc.png" alt="image-20210317100003102" style="zoom:67%;" />

关键字、运算符、分界符采用一符一码，标识符和常数采用类别编码：

<img src="https://i.loli.net/2021/03/25/XqIbtE4hkVZfriy.png" alt="截屏2021-03-25 下午10.15.45" style="zoom:50%;" />

一符一码的属性值就是空（实际上就是种别码）：

<img src="https://i.loli.net/2021/03/25/ENL1cedBbnFW8Zt.png" alt="image-20210325222046170" style="zoom:50%;" />

#### 3.1.3 源程序的输入缓冲与预处理

超前搜索与回退：对双字符运算符，如+=、++需要使用

一个指针为单词开始指针Begin，一个为向前指针forward

#### 3.1.4 词法分析阶段的错误处理

非法字符检查、不封闭错误检查、关键字拼写错误检查、重复说明检查、错误恢复与续编译

错误恢复策略：恐慌模式，反复**删掉**剩余输入最前面的字符，知道词法分析器发现一个能正确识别的单词为止

#### 3.1.5 词法分析器在整体结构中的位置

以语法分析器为中心，将词法分析器设为单独的一边扫描：

* 简化了编译器的设计
* 提高编译器的效率
* 增强编译器的可移植性：将输入（读文件）限定在词法分析器之中

<img src="C:\Users\17852\AppData\Roaming\Typora\typora-user-images\image-20210517144004713.png" alt="image-20210517144004713" style="zoom:40%;" />

## 3.2 单词的描述

正则表达式可以很直观地来描述单词的构成，但代码实现需要使用DFA

正则文法和正则表达式和有穷自动机等价

#### 有穷状态自动机

系统根据当前所处的状态和面临的输入即可确定后继的行为。

确定的有穷自动机：$M=(Q,\Sigma,\delta,q_0,F)$

<img src="https://i.loli.net/2021/03/26/gEMhsdp2TRl5Cxu.png" alt="image-20210326075829298" style="zoom:50%;" />

NFA比DFA更直观，DFA比NFA更易于实现

#### 状态转换图

正则表达式到状态转换图的转换：

<img src="E:\哈工大计算机课程资料\编译系统\HIT-Compile_System\chapter3 词法分析.assets\image-20210517145711178.png" alt="image-20210517145711178" style="zoom:50%;" />

## 3.3 单词的识别

自动机状态上的*表示向前指针必须回退一个字符

八进制数：0[0-7]+

<img src="E:\哈工大计算机课程资料\编译系统\HIT-Compile_System\chapter3 词法分析.assets\image-20210517150514516.png" alt="image-20210517150514516" style="zoom:50%;" />

十进制数：\[1-9][0-9]\*|0

<img src="E:\哈工大计算机课程资料\编译系统\HIT-Compile_System\chapter3 词法分析.assets\image-20210517150527349.png" alt="image-20210517150527349" style="zoom:50%;" />

十六进制数：0x[0-9a-fA-F]+

<img src="E:\哈工大计算机课程资料\编译系统\HIT-Compile_System\chapter3 词法分析.assets\image-20210517150535286.png" alt="image-20210517150535286" style="zoom:50%;" />

总体：

<img src="E:\哈工大计算机课程资料\编译系统\HIT-Compile_System\chapter3 词法分析.assets\image-20210517150622175.png" alt="image-20210517150622175" style="zoom:50%;" />

## 本章小结

* 词法分析器接收表示源程序的“平滑字符流”，输出与之等价的单词序列；
* 单词被分成很多类，并被表示成（种别码，属性值）的二元组形式；
* 为了提高效率，词法分析器使用缓冲技术，而且在将字符流读入缓冲区时，是经过剔除注解、无用空白符等预处理后的结果；
* 单词的识别相当于正则语言的识别；
* 词法的等价描述形式有正则文法、有穷状态自动机、正则表达式，其中有穷状态自动机可以用状态转换图表示；
* 实现词法分析器时状态转换图是一个很好的设计工具，根据该图，容易构造出相应的分析程序；
* 使用恰当的形式化描述，可以实现词法分析器的自动生成，Lex就是一种自动生成工具。