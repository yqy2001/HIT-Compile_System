## LR分析法（状态法）

LR分析法是**无回溯**的移进-规约分析方法；几乎所有描述程序设计语言的上下文无关文法，都能构造LR语法分析器；可以用LR方法分析的文法类是可以用LL法分析的文法类的**真超集**。

### LR(k)分析法：

L：指从左到右扫描输入符号；
R：反向构造最右推导，即最左规约；
k：超前读入k个符号，以确定规约用的产生式(啥时候归约、怎样归约)。

思想：分析器根据当前状态，至多向前查看k个输入符号，就可以确定是否找到了句柄。若找到句柄，则可规约；若未找到句柄，则移进输入符号。移进和归约的过程中伴随着状态的转移。

LR语法分析器的总体结构：

结构如下图所示，工作流程为：分析程序从输入缓冲区中读入符号，根据分析表查询应该执行的操作，更新状态/符号栈。

所有LR分析器(LR(0)、SLR(1)、LR(1)、LALR(1))的主控程序、执行逻辑都是一样的，不同的语法分析器具有不同的分析表

![image-20210407085717240](https://i.loli.net/2021/04/07/uZcnlM7A4fFo6aj.png)

### LR(0)分析表的构造

思想：使用自动机维护一些状态，这些状态记录和追踪句柄形成的进程。

LR(0)项目：右部某个位置标有圆点的产生式，称为LR(0)项目。若产生式的右部有n个符号，其对应的LR(0)项有n+1个。

例：对于产生式S➡bBB，其各项目为：

* 归约项目：S→bBB.
* 移进项目：S→.bBB
* 待约项目：S→b.BB、S→bB.B
* 接受项目：若S是开始符号，S→aBB.

自动机的状态是LR(0)项目的集合，使用LR(0)项目表示句柄的形成进度。

LR(0)自动机：
$$
M=(Q,\Sigma,\sigma,q_0,F)
$$
增广文法：

文法$G=(V, T, P, S)$的增广文法为$G'=(V \cup {S'}, T, P \cup {S'→S}, S'), S'\notin V$

* 初始项目：$S'→.S$
* 接受项目：$S'→S.$

将等价的项目组成一个项目集，成为项目集闭包，每个项目集闭包对应自动机的一个状态。

闭包：${\rm CLOSURE(I)}=I\cup\{B→.\gamma|A→\alpha.B\beta\in I,B→\gamma\in P\}$，B是非终结符。

例：

![image-20210407093950384](https://i.loli.net/2021/04/07/PbdGkL6DUYOgnh1.png)