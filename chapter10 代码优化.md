对代码进行等价的变换，使之运行的更快、占用的空间更少。

## 2、控制流分析

d支配n，若存在n到d的边，这条边称为回边。

要先分析程序的控制流程，描述程序控制流程的一种工具：流图

自然循环：有**唯一的入口**结点，称为首结点，首结点**支配**循环中的**所有节点**。循环中至少有一条返回首结点的路径。

给定一个回边n→d，其自然循环为，支配结点d加上所有不经过d而可以到达n的结点。d为该循环的首结点。

除非两个自然循环的首结点相同，否则他们或者互不相交，或者一个完全包含在另外一个里面。

最内循环是不包含任何循环的循环，若首结点相同，可合并。

### 基本块

流图中的每一个结点是一个基本块

第一条指令是首指令

<img src="chapter10 代码优化.assets/image-20210526235003549.png" alt="image-20210526235003549" style="zoom:50%;" />

流图基本块算法：

<img src="chapter10 代码优化.assets/image-20210527002525813.png" alt="image-20210527002525813" style="zoom:50%;" />

## 3、数据流分析

#### 到达-定值分析：

只要**存在**路径能到达，某条语句（赋值）就不会被杀死，到达是指到达基本块的入口处。

直观的说，若某个变量x的一个定值d到达了点p，在p处使用的x的值就**可能**是由d最后赋予的。

ud链、引用定值链

#### 活跃变量分析：

对于变量x和程序点p，如果流图中沿着从p开始的某条路径会**引用**x在p点的值，则称x在p点活跃。

用途：删除无用赋值

若x在p点不活跃，则x在p点的定值就是无用的

#### 可用表达式分析：

直观意义：在点p上，x op y已经被计算过，且x和y的值都没有改变，不需要重新计算。

用途：消除全局公共子表达式、进行复制传播

## 4、局部优化（基本块优化）

DAG可以自动计算局部重复子表达式

#### 删除无用代码：

DAG的根结点在基本块内不被引用，若不是活跃变量（在基本块外会被引用的变量），则可将其删除。

不断重复。

## 